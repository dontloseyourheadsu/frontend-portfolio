# Netlify configuration for Angular app in ./frontend
# This file overrides settings in the Netlify UI (source of truth)
# Docs: https://docs.netlify.com/configure-builds/file-based-configuration/

[build]
# Build from the root, but run commands in frontend
command = "cd frontend && npm ci && npm run build"
# Angular 16+ default output is dist/<project-name>/browser (relative to root)
publish = "frontend/dist/frontend/browser"
functions = "netlify/functions"

[dev]
command = "npm start --prefix frontend"
targetPort = 4200
publish = "frontend/dist/frontend/browser"

# Force the Node.js version if needed (optional)
[build.environment]
# Uncomment to pin Node version used by Netlify build image
# NODE_VERSION = "20"

# Redirect all SPA routes to index.html so Angular Router can handle them
# This is equivalent to _redirects: /*  /index.html  200
[[redirects]]
from = "/*"
to = "/index.html"
status = 200

# Set useful caching headers
# Fingerprinted assets can be cached long-term, HTML should not
[[headers]]
for = "/**/*.js"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/**/*.css"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/assets/*"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

# [[headers]]
# for = "/**/*.{png,jpg,jpeg,gif,webp,avif,svg,ico}"
# [headers.values]
# Cache-Control = "public, max-age=31536000, immutable"

# [[headers]]
# for = "/**/*.{woff,woff2,ttf,otf}"
# [headers.values]
# Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "/index.html"
[headers.values]
Cache-Control = "no-cache"

# Security headers (baseline)
[[headers]]
for = "/*"
[headers.values]
X-Frame-Options = "DENY"
X-Content-Type-Options = "nosniff"
Referrer-Policy = "no-referrer-when-downgrade"
Permissions-Policy = "interest-cohort=()"
